<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F2FVCA</title>
</head>
<style>
  .video{
    height:100%;
    width: 100%;
    object-fit: cover;
    border-radius: 20px;
  }
  h1 {
	font-family:" 'Mate SC', serif";
	font-size: 40px;
	color: white;
	background: transparent;
	background-color: #8566aa;
	padding: 6px 0 2px 0;
	margin-bottom: 0px;
	text-align: center;
}
h1:hover{
	color:black;
  }
  input {
	font-family: 'Oswald', sans-serif;
	text-align: center;
	height: 70px;
	border: none;
	background: transparent;
	font-size: 20px;
	width: 60%;
  margin-top: -10px ;
	border-bottom: 2px solid #6b5a80;
}
.sbtn{
  /* border:1px solid; */
  padding: 4px;
  border-radius: 40%;
}
.sbtn:hover{
  background-color: grey;
  cursor: pointer;
}

</style>
<script>
  const toggle=(id)=>{
    var butval = document.getElementById(id).value
    document.getElementById(id).value = (butval=="0" ? "1" : "0")
    console.log(butval)
  }
</script>
<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>

<body>
    <h1>Face 2 Face Video Calling App</h1> 
    <div style="display: flex;flex-direction: row;
    justify-content: center;">
    <div>
    <div style="display:flex;align-items: center; padding:10px">
      <br>
      <input id="callingid"/>
      <img id="callpeer" 
      src="https://freepngimg.com/thumb/telephone/70827-google-contacts-mobile-phones-telephone-contact-call-thumb.png"
      style="top:10px;height:70px;object-fit: cover; width:70px "
      ></img>
      <div id="status"> </div>
    </div>
    <div style="display: flex;align-items: left;">
      <div id="myvideo" style="height: 60vh; width: 45vw; border: 1px ; border-radius: 20px; overflow:hidden"></div>&nbsp;&nbsp;
      <div id="peervideo" style="height: 60vh; width: 45vw; border: 1px; border-radius: 20px; overflow:hidden"></div>
    </div>
    <br/>
    <span>
    <span id="videobutton" class=sbtn></span>&nbsp;
    <span id="videostatus"></span></span>&nbsp;
    <span><span id="audiobutton" class=sbtn></span>&nbsp;
    <span id="audiostatus"></span></span>
    
  </div>
  </div>
  <h1 id="peer"></h1>
  <!-- <footer style="position:absolute; top:85vh; width:100%">
    <h1 id="peer"></h1>
  </footer> -->
</body>
<script>
  window.addEventListener('load',(event)=>{
    var peer = new Peer()
    var avlpeer=[]
    peer.on("call",(call)=>{
      // var mikeval= document.getElementById("mikeval").value =="1"
    //  var videoval= document.getElementById("videoval").value =="1"
    //  console.log(mikeval,videoval)
     navigator.mediaDevices.getUserMedia({video:true,audio:true})
     .then((stream)=>{
      var buttonvid =document.createElement("buttonvideo")

buttonvid.appendChild(document.createTextNode("Video " ));
document.getElementById("videostatus").innerHTML = (stream.getVideoTracks()[0].enabled ? "ON" : "OFF")
buttonvid.onclick=()=>{
  // console.log(stream.getVideoTracks()[0])
  stream.getVideoTracks()[0].enabled = !stream.getVideoTracks()[0].enabled 
  document.getElementById("videostatus").innerHTML = (stream.getVideoTracks()[0].enabled ? "ON" : "OFF")
}
document.getElementById("videobutton").append(buttonvid)

var buttonmic = document.createElement("buttonmic")
buttonmic.appendChild(document.createTextNode("Mic"))
document.getElementById("audiostatus").innerHTML = (stream.getAudioTracks()[0].enabled ? "ON" : "OFF")
buttonmic.onclick=()=>{
  // console.log(stream.getAudioTracks()[0])
  stream.getAudioTracks()[0].enabled = !stream.getAudioTracks()[0].enabled
  document.getElementById("audiostatus").innerHTML = (stream.getAudioTracks()[0].enabled ? "ON" : "OFF")
  
}
document.getElementById("audiobutton").append(buttonmic)
       call.answer(stream)
       addmine(stream)
       call.on('stream',(stream)=>{
         if(!avlpeer.includes(call.peer)){
           remotevideoadder(stream)
           avlpeer.push(call.peer)
           document.getElementById("status").innerHTML = "Recieved Connection from " + call.peer
          }
       })
     }).catch((e)=>{console.log(w)})
    })
    const callpeer=(id)=>{
      // var mikeval= document.getElementById("mikeval").value =="1"
    //  var videoval= document.getElementById("videoval").value =="1"
    //  console.log(mikeval,videoval)
     navigator.mediaDevices.getUserMedia({video:true,audio:true})
     .then((stream)=>{
      
      

      var buttonvid =document.createElement("buttonvideo")
      buttonvid.appendChild(document.createTextNode("Video"));
      document.getElementById("videostatus").innerHTML = (stream.getVideoTracks()[0].enabled ? "ON" : "OFF")

      buttonvid.onclick=()=>{
        // console.log(stream.getVideoTracks()[0])
        stream.getVideoTracks()[0].enabled = !stream.getVideoTracks()[0].enabled 
        document.getElementById("videostatus").innerHTML = (stream.getVideoTracks()[0].enabled ? "ON" : "OFF")
      }
      document.getElementById("videobutton").append(buttonvid)

      var buttonmic = document.createElement("buttonmic")
      buttonmic.appendChild(document.createTextNode("Mic"))
      document.getElementById("audiostatus").innerHTML = (stream.getAudioTracks()[0].enabled ? "ON" : "OFF")
      buttonmic.onclick=()=>{
        stream.getAudioTracks()[0].enabled = !stream.getAudioTracks()[0].enabled
        document.getElementById("audiostatus").innerHTML = (stream.getAudioTracks()[0].enabled ? "ON" : "OFF")
      }
      document.getElementById("audiobutton").append(buttonmic)

       addmine(stream)
       let calling  = peer.call(id,stream)
       calling.on('stream',(stream)=>{
        if(!avlpeer.includes(calling.peer)){
           remotevideoadder(stream)
           avlpeer.push(calling.peer)
           document.getElementById("status").innerHTML = "Connected to " + calling.peer
          }
       })
     }).catch((e)=>{console.log(e)})
    }
    const addmine =(stream)=>{
      let video = document.createElement("video")
      video.classList.add("video")
      video.srcObject = stream;
      video.play()
      video.muted=true
      document.getElementById("myvideo").append(video)
      
    }
    const remotevideoadder=(stream)=>{
      let video = document.createElement("video")
      video.classList.add("video")
      video.srcObject = stream;
      video.play()
      document.getElementById("peervideo").append(video)
    }
    const toggle=()=>{
      console.log(e)
    }
    peer.on('open',(id)=>{
      document.getElementById("peer").innerHTML = "Your id: " + id
     })
     document.getElementById("callpeer").addEventListener('click',(e)=>{
         let otherpeer=document.getElementById("callingid").value
         document.getElementById("status").innerHTML = "connecting to " + otherpeer
         callpeer(otherpeer)
       })
  })
</script>
</html>